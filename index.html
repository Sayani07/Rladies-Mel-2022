<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Building a new geom in ggplot2</title>
    <meta charset="utf-8" />
    <meta name="author" content="  Sayani Gupta    Sayani07      SayaniGupta07   https://sayanigupta-useR2020.netlify.com/" />
    <script src="libs/header-attrs-2.14/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/ninjutsu.css" rel="stylesheet" />
    <!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script> 
    -->
    <link rel="icon" href="images/favicon.ico"  type='image/x-icon'/>    
    <link rel="stylesheet" href="assets/animate.css" type="text/css" />
    <link rel="stylesheet" href="assets/monash-logo.css" type="text/css" />
    <link rel="stylesheet" href="assets/monash-brand.css" type="text/css" />
    <link rel="stylesheet" href="assets/monash-fonts.css" type="text/css" />
    <link rel="stylesheet" href="assets/styles.css" type="text/css" />
    <link rel="stylesheet" href="assets/custom.css" type="text/css" />
    <link rel="stylesheet" href="assets/demo.css" type="text/css" />
    <link rel="stylesheet" href="timeline.css" type="text/css" />
    <link rel="stylesheet" href="libs/font-awesome/css/fontawesome-all.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Building a new geom in ggplot2
]
.author[
### <br> Sayani Gupta <br> <i class='fab fa-github'></i> Sayani07     <i class='fab fa-twitter' style='color:#6CADDE'></i> SayaniGupta07 <br><font> <small><a href="https://sayanigupta-useR2020.netlify.com/" class="uri">https://sayanigupta-useR2020.netlify.com/</a></small>
]
.date[
### <font size = "7"> R-Ladies Melbourne
]

---






class: top left

# About me

---

# Object-oriented programming

building tools for data analysis

---
# Data example we will play with 

---
# Decomposing (Extension points) a ggplot into its consituents

- Theme
- scales
- positions
- statistics
- geometries
- coordinates
- facets

&lt;!-- - mapping  --&gt;
&lt;!-- - data --&gt;

---

# Many geoms exists, why build a new one?

- customize and integrate new graphical elements with existing ggplot2 visualizations, resulting in a broad range of informative graphics


- ggplot2 creates graphics based on The Grammar of Graphics
- graphics are built step by step by adding new elements that allows for extensive flexibility and customization of plots
- need to extend the functionality of ggplot2


- connecting the underlying theory of ggplot2 and The ggplot2 API

- 47 geoms, 25 stats and 62 scales

complete story told my multiple plots


Gallery for ggplot2 extensions
https://exts.ggplot2.tidyverse.org/gallery/
---

# What is the challenge(s)

- Difficult to understand how ggplot2 translates a plot specification into an image.
- ggplot2 interface is different to the structure of the underlying machinery that makes it work.

---

# Play with some geom

Show same stat and geoms are different giving it a different geometry
---

# Play with some stat

Show same stat and geoms are different giving it a different stat
---

# Structure ofggplot method

```
ggprint &lt;- function(x) {
  data &lt;- ggplot_build(x) .......(1)
  gtable &lt;- ggplot_gtable(data)......(2)
  grid::grid.newpage()
  grid::grid.draw(gtable)......(3)
  return(invisible(x))
}
```

---

# ggbuild -&gt; Build step

ggplot_build(), as discussed above, takes the declarative representation constructed with the public API and augments it by preparing the data for conversion to graphic primitives.

## Data preparation

## Data transformation

## Output

---
# gtable

All drawing is performed by the grid package together with the active graphics device. 

Its job is to convert user data to one or more graphical primitives such as polygons, lines, points, etc and then hand responsibility over to the grid package.

##  Rendering the panels


## Adding guides
---

# Graphing distribution summaries


.left-column[
- several ways to summarize a distribution
- R package ggdist for visualizing distributions and uncertainty
]

.right-column[
![](images/allplots.png)&lt;!-- --&gt;
]
---
class: top left

# Different summarization expose different features

.left-column[
- Boxplot not suitable for summarizing multi-modal distributions
- often useful to display different summarization in unison
]

.right-column[
![](images/question1.png)&lt;!-- --&gt;
]
---

background-image: url("images/hdr_paper.png")

background-position: center
background-size: contain


---
# Highest Density Region (HDR) plots

&lt;font size = "3.5"&gt; If `\(f(x)\)` is the density function of a random variable `\(X\)`, then the 100 `\((1 -\alpha)\)` HDR is the subset `\(R(f_\alpha)\)` of the sample space of `\(X\)` such that `\(R(f_\alpha) = \{x: f(x) \geq f_\alpha\}\)`, where `\(f_\alpha\)` is the largest constant such that `\(Pr(X \in R(f_\alpha)) \geq 1-\alpha)\)`.

&lt;img src="images/falpha.png" width="80%" /&gt;

---
# Graphing HDRs using R package hdrcde

&lt;i&gt;&lt;font size = "4"&gt; Data set: Waiting time between eruptions and the duration of the eruption for the Old Faithful geyser in Yellowstone National Park, Wyoming, USA. &lt;/font size = "4"&gt;&lt;/i&gt;

.pull-left[
```r
faithful %&gt;% as_tibble
```


```
## # A tibble: 272 × 2
##    eruptions waiting
##        &lt;dbl&gt;   &lt;dbl&gt;
##  1      3.6       79
##  2      1.8       54
##  3      3.33      74
##  4      2.28      62
##  5      4.53      85
##  6      2.88      55
##  7      4.7       88
##  8      3.6       85
##  9      1.95      51
## 10      4.35      85
## # … with 262 more rows
```

]

.pull-right[
![](index_files/figure-html/faithful-density-1.png)&lt;!-- --&gt;
]

---

# Graphing HDRs using R package hdrcde

&lt;img src="images/allplots1png.png" width="90%" /&gt;
---
What are:
* the geoms
* the stats
* the coord
* the data

---
# Extending ggplot2

- HDR is a novel technique for summarizing distribution for which plotting is not implemented in ggplot2
- ggplot2 creates graphics based on The Grammar of Graphics
- graphics are built step by step by adding new elements that allows for extensive flexibility and customization of plots
- need to extend the functionality of ggplot2

Defining features of a circle??

Always subclass an existing class (make a new stat)

Class construction
data preparation
calculation
requirements

---
class: top left

# Package gghdr

.pull-left[

- implement HDR plots in ggplot2 
- key elements: *geom* and *stats*
- inspired from R package [`hdrcde`](https://pkg.robjhyndman.com/hdrcde/) developed by [Rob
Hyndman](https://robjhyndman.com/)
]


.pull-right[

.animated.bounce[
&lt;img src="images/gghdr_logo.png" height=280px&gt;
]
]


---
# HDR boxplots

.pull-left[
```r
library(hdrcde)
hdr.boxplot(faithful$eruptions) 
```
&lt;br&gt;

![](index_files/figure-html/hdrcde-boxplot-1.png)&lt;!-- --&gt;

]

.pull-right[

```r
library(gghdr)
library(ggplot2)
ggplot(faithful, aes(y = eruptions)) +
  geom_hdr_boxplot()
```

![](index_files/figure-html/geom-hdr-boxplot-1.png)&lt;!-- --&gt;
]

---

# HDR rug plots and scatter plots


.pull-left[

```r
faithful %&gt;% 
  ggplot(aes(x = waiting, 
             y = eruptions)) + 
  geom_hdr_rug(fill = "blue") + 
  geom_point() 
```

![](index_files/figure-html/hdr-rug-1.png)&lt;!-- --&gt;
]

.pull-right[

```r
faithful %&gt;%
  ggplot(aes(x = waiting,
             y = eruptions)) +  
  geom_point(aes(colour =  
  hdr_bin(x = waiting,y = eruptions)))
```
  
![](index_files/figure-html/hdr-scatter-1.png)&lt;!-- --&gt;

]
---
class: top left

# Keep combining - HDR box + jitter

.pull-left[

```r
faithful %&gt;% 
 ggplot(aes(y = eruptions)) + 
*geom_hdr_boxplot(fill = c("blue")) + 
*geom_jitter(aes(x = 0))
```
- jitter to supplement the insight drawn from the HDR boxplot

]

.pull-right[
![](index_files/figure-html/geom-hdr-box-jitter-1.png)&lt;!-- --&gt;
]




---
class: top left

# Keep combining - HDR scatter + HDR marginal

.pull-left[
```r
faithful %&gt;% 
ggplot(aes(x = waiting, y = eruptions)) +
* geom_point(aes(colour = hdr_bin(x = waiting, y = eruptions)))+
* geom_hdr_rug()
```

- Both bivariate and marginal HDRs displayed at once
- Bimodality in both marginal and bivariate distributions

]


.pull-right[

![](index_files/figure-html/combo-1.png)&lt;!-- --&gt;
]

---

# Authors

![](images/authors1.png)&lt;!-- --&gt;

---
class: middle top

#  More Information

Package: https://github.com/ropenscilabs/gghdr  

Slides: https://sayanigupta-useR2020.netlify.com/  

Materials: https://github.com/Sayani07/useR2020    


Slides created with &lt;i&gt; Rmarkdown, knitr, xaringan, xaringanthemer&lt;/i&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "solarized-light",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'assets/mathjax-local/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
